<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mise tienda onlinevr0.299</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        /* --- ESTILOS CSS BASE (LIGHT MODE / CLON IMAGEN) --- */
        :root {
            --color-primario: #FF3B30;   /* Rojo / Naranja - Acciones principales y precios */
            --color-secundario: #FF5E3A; /* Rojo Brillante - Descuentos y alertas (similar) */
            --color-negro: #1c1c1c;      /* Texto principal (negro para light mode) */
            --color-fondo-app: #f5f5f5;  /* Fondo muy claro, casi blanco */
            --color-gris-claro: #ffffff; /* Fondo de tarjetas y secciones (blanco puro) */
            --color-gris-medio: #8e8e93; /* Texto secundario */
            --color-alerta: #FF9800;     /* Naranja para stock/advertencias */
            --color-header-bg: #1c1c1c;  /* Fondo del header oscuro/negro */
        }

        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@100;400;700;900&display=swap');

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', 'Helvetica Neue', Arial, sans-serif; }
        
        /* 1. CAMBIO DE FONDO: IMAGEN DE FONDO GENERAL PARA EL BODY */
        body { 
            background-color: transparent; 
            background-image: url('https://i.ibb.co/3q0Wqys/33-sin-t-tulo-20251201081549.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            display: flex; 
            justify-content: center; 
            min-height: 100vh; 
            color: var(--color-negro); 
        }

        .app-container {
            width: 100%; 
            max-width: 420px; 
            background-color: rgba(255, 255, 255, 0.95); 
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.1); 
            display: flex; 
            flex-direction: column; 
            position: relative;
        }
        
        /* --- CORRECCIN: ESTILOS DEL MEN LATERAL (SIDE MENU) --- */
        #side-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 70%;
            max-width: 250px;
            height: 100%;
            background-color: #ffffff;
            box-shadow: 2px 0 10px rgba(0,0,0,0.4);
            z-index: 100; /* Asegura que est茅 sobre todo, incluyendo el overlay */
            transition: transform 0.3s ease-out;
            transform: translateX(-100%); /* Oculto inicialmente fuera de pantalla */
            padding: 20px 10px;
            overflow-y: auto;
        }

        #side-menu.open {
            transform: translateX(0); /* Se desliza para mostrarse */
        }
        
        /* Estilos para los items del men煤 lateral */
        .menu-item {
            padding: 10px 15px;
            margin-bottom: 5px;
            font-size: 16px;
            color: var(--color-negro);
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.1s;
        }
        .menu-item:hover {
            background-color: #f0f0f0;
        }

        /* Contenedor de Vistas */
        #main-app-content, #product-detail-view, #registration-view, #profile-view, #cart-view, #privacy-policy-view, #saved-view {
            width: 100%; 
            flex-grow: 1; 
            background-color: transparent; 
            position: absolute; 
            top: 0; 
            left: 0; 
            z-index: 20; 
            overflow-y: auto; 
            padding-bottom: 60px; 
            display: none;
        }
        #main-app-content { display: flex; flex-direction: column; } 
        
        /* Header y navegaci贸n */
        .view-header {
            display: flex; justify-content: space-between; align-items: center; 
            padding: 5px 10px; 
            background-color: #ffffff; 
            border-bottom: 1px solid #eee; 
            color: var(--color-negro);
        }
        .view-header i.fa-arrow-left {
            font-size: 20px; 
            padding: 10px; 
            cursor: pointer;
            color: var(--color-negro); 
        }
        .view-header h3 { 
            flex-grow: 1;
            text-align: center;
            margin-right: 40px; 
        }
        
        /* --- CLON HEADER DE IMAGEN --- */
        .header-top { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 8px 10px; 
            background-color: var(--color-header-bg); 
            color: white; 
            border-bottom: none; 
        }
        .header-top .icon-btn {
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
            color: white;
        }
        .search-bar { 
            flex-grow: 1; 
            margin: 0 10px; 
            position: relative; 
        }
        .search-bar input { 
            width: 100%; 
            padding: 8px 35px 8px 15px; 
            border: 1px solid #ccc; 
            border-radius: 20px; 
            font-size: 14px; 
            background-color: #ffffff; 
            color: var(--color-negro) !important;
        }
        .search-bar i.fa-search {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-gris-medio);
            font-size: 14px;
        }

        /* --- CLON MEN DE CATEGORAS TIPO CRCULO --- */
        .category-menu { 
            display: flex; 
            overflow-x: auto; 
            padding: 10px 0; 
            white-space: nowrap; 
            background-color: var(--color-gris-claro); 
            border-bottom: 1px solid #eee; 
        }
        .category-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            margin: 0 10px;
            cursor: pointer;
            min-width: 60px; 
        }
        .category-icon-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 5px;
            background-color: #f0f0f0; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: background-color 0.2s, box-shadow 0.2s;
        }
        .category-icon-circle i {
            font-size: 20px;
            color: var(--color-negro);
            transition: color 0.2s;
        }
        .category-wrapper span { 
            font-size: 12px; 
            color: var(--color-negro); 
            font-weight: 500;
            transition: color 0.2s;
        }
        
        /* FIX: ESTILO DE CATEGORA ACTIVA (Correcci贸n de men煤 superior) */
        .category-wrapper.active .category-icon-circle {
            background-color: var(--color-primario);
            box-shadow: 0 0 0 3px rgba(255, 59, 48, 0.5);
        }
        .category-wrapper.active .category-icon-circle i {
            color: white;
        }
        .category-wrapper.active span {
            color: var(--color-primario);
            font-weight: 700;
        }
        
        /* OCULTAR ELEMENTOS VIEJOS DE FILTRO */
        .category-menu-original {
             display: none !important;
        }
        .category-menu div:not(.category-wrapper) {
             display: none;
        }
        
        /* 2. CAMBIO DE BANNER: IMAGEN DE BANNER */
        .main-banner { 
            background-image: url('https://i.ibb.co/v4DgYG7h/34-sin-t-tulo-20251201083437.png'); 
            background-size: cover;
            background-position: center;
            height: 150px; 
            padding: 0; 
            border-radius: 0;
            box-shadow: none;
            border-bottom: 1px solid #eee;
        }
        .main-banner h3, .main-banner p { display: none; }

        .info-bar { 
            display: flex; justify-content: space-around; padding: 10px 0; 
            background-color: #f7f7f7; 
            border-bottom: 1px solid #eee; 
            color: var(--color-negro);
        }
        
        /* FIX: Quitar potenciales separadores verticales (el "|") */
        .info-item { 
            border-right: none !important; 
            border-left: none !important;
        }
        .detail-mid-info-bar > div {
            border-right: none !important;
            border-left: none !important;
        }

        .info-item span { font-size: 12px; margin-left: 5px; }
        .info-item i { color: var(--color-primario); }
        
        .section-header-bar { display: none; } 

        .main-content { 
            padding: 15px 10px 10px; 
            overflow-y: auto; 
            flex-grow: 1; 
            background-color: transparent; 
        }
        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; } 
        
        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--color-negro);
            margin-bottom: 15px;
            border-left: 4px solid var(--color-primario);
            padding-left: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            padding-top: 5px;
            padding-bottom: 5px;
        }

        /* TARJETA DE PRODUCTO */
        .product-card { 
            background-color: var(--color-gris-claro); 
            border-radius: 8px; 
            overflow: hidden; 
            box-shadow: 0 2px 1px rgba(0, 0, 0, 0.1); 
            cursor: pointer; 
            border: 0px solid #f0f0f0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .product-card img { width: 100%; height: 120px; object-fit: cover; display: block; background-color: #f5f5f5; }
        
        .product-details {
             padding: 8px;
             display: flex;
             flex-direction: column;
             flex-grow: 1;
        }
        .product-price .current-price {
            font-size: 16px;
            font-weight: bold;
            color: var(--color-primario);
        }
        .product-price .old-price {
            font-size: 11px;
            color: var(--color-gris-medio);
            text-decoration: line-through;
            margin-left: 5px;
        }
        .tag-black-friday {
            background-color: var(--color-secundario);
            color: white;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 5px;
            border-radius: 3px;
            display: inline-block;
        }
        .free-shipping-tag {
             background-color: #4CAF50;
             color: white;
             font-size: 10px;
             font-weight: bold;
             padding: 2px 5px;
             border-radius: 3px;
             display: inline-block;
             margin-left: 5px;
        }
        
        .add-to-cart-grid-btn {
            width: 100%;
            padding: 5px;
            margin-top: 8px;
            background-color: var(--color-primario);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 13px;
            cursor: pointer;
            font-weight: bold;
        }

        .flash-product-strip {
            display: flex;
            overflow-x: scroll; 
            gap: 10px; 
            padding: 5px 0 10px; 
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; 
        }
        .flash-product-strip::-webkit-scrollbar {
            display: none; 
        }
        
        .flash-item-card {
            min-width: 120px;
            max-width: 120px;
            background-color: var(--color-gris-claro);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
            padding: 8px;
            border: 1px solid #eee;
            text-align: center;
            cursor: pointer;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .flash-item-card img {
            width: 100%;
            height: 70px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 5px;
            background-color: #f5f5f5;
        }

        /* Footer Nav (Barra de abajo) */
        .footer-nav { 
            display: flex; justify-content: space-around; padding: 5px 0; border-top: 1px solid #ccc; 
            background-color: #ffffff; 
            position: fixed; bottom: 0; width: 100%; max-width: 420px; z-index: 30; 
            color: var(--color-negro);
        }
        .footer-nav .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--color-gris-medio); 
            font-size: 12px;
        }
        .footer-nav .nav-item i {
            font-size: 18px;
            margin-bottom: 2px;
        }
        .footer-nav .nav-item.active {
            color: var(--color-primario); 
        }
        .cart-count {
            background-color: var(--color-secundario);
            color: white;
            font-size: 9px;
            border-radius: 50%;
            padding: 0px 4px;
            line-height: 1.3;
        }

        /* Footer de Producto Detalle (Fijo) */
        .detail-info-footer {
            background-color: #ffffff; 
            border-top: 1px solid #eee;
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 420px; 
            z-index: 30;
            padding: 10px 15px;
            display: flex; 
            justify-content: space-between;
            align-items: center;
        }

        /* --- ESTILO CRTICO DEL TOAST (NOTIFICACIN) --- */
        #app-toast {
            visibility: hidden;
            min-width: 250px;
            background-color: var(--color-primario); 
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px 15px;
            position: fixed;
            z-index: 1000;
            left: 50%;
            top: 0; 
            transform: translateX(-50%) translateY(-100%);
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: transform 0.4s ease-out, visibility 0s 0.4s;
        }
        
        #app-toast.show {
            visibility: visible;
            transform: translateX(-50%) translateY(50px); 
            transition: transform 0.4s ease-out;
        }
        
        /* --- VISOR DE IMAGEN EN PANTALLA COMPLETA --- */
        #full-screen-image-viewer {
            transition: opacity 0.3s ease;
        }
        
        /* --- ESTILO DEL BOTN DE GUARDAR --- */
        .view-header #save-product-btn {
            transition: color 0.1s ease;
        }
        
    </style>
</head>
<body>

    <div class="app-container">

        <div id="side-menu">
             <div style="font-size: 20px; font-weight: bold; margin-bottom: 30px; color: var(--color-primario);">Mise</div>
            <div class="menu-item" onclick="handleMenuClick('main')"><i class="fa-solid fa-home" style="margin-right: 10px;"></i> Inicio</div>
            <div class="menu-item" onclick="handleMenuClick('profile')"><i class="fa-solid fa-user-circle" style="margin-right: 10px;"></i> Mi Perfil</div>
            <div class="menu-item" onclick="handleMenuClick('cart')"><i class="fa-solid fa-shopping-cart" style="margin-right: 10px;"></i> Carrito</div>
            <div class="menu-item" onclick="handleMenuClick('saved')"><i class="fa-solid fa-heart" style="margin-right: 10px;"></i> Mis Guardados</div>
            <div class="menu-item" onclick="handleMenuClick('sell')"><i class="fa-solid fa-store" style="margin-right: 10px;"></i> Vender Mis Productos</div>
            <div class="menu-item" onclick="handleMenuClick('support')"><i class="fa-solid fa-question-circle" style="margin-right: 10px;"></i> Soporte y Ayuda</div>
            <div class="menu-item" onclick="handleMenuClick('privacy')"><i class="fa-solid fa-shield-alt" style="margin-right: 10px;"></i> Pol铆tica de Privacidad</div>
            <div class="menu-item" onclick="handleMenuClick('logout')" style="color: var(--color-secundario); margin-top: 30px;"><i class="fa-solid fa-sign-out-alt" style="margin-right: 10px;"></i> Cerrar Sesi贸n </div>
        </div>
        <div id="menu-overlay" onclick="toggleSideMenu()" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; max-width: 420px; background-color: rgba(0,0,0,0.7); z-index: 90; display: none;"></div>


        <div id="main-app-content" style="display: flex;">
            <header>
                <div class="header-top">
                    <i class="fa-solid fa-list-ul icon-btn" onclick="toggleSideMenu()"></i>
                    <div class="search-bar">
                        <input type="text" id="search-input" placeholder="buscar mi producto" onkeyup="handleSearch()">
                        <i class="fa-solid fa-search"></i>
                    </div>
                    <i class="fa-solid fa-tags icon-btn" onclick="openSellLink()" title="Vender Aqu铆"></i>
                </div>
                
                <div class="category-menu" id="category-menu-top">
                    <div data-category="all" class="active category-menu-original" onclick="filterByCategory('all', this)">Todos</div>
                    <div data-category="juguetes" class="category-menu-original" onclick="filterByCategory('juguetes', this)">Juguetes</div>
                    <div data-category="moda" class="category-menu-original" onclick="filterByCategory('moda', this)">Moda</div>
                    <div data-category="tecnolog铆a" class="category-menu-original" onclick="filterByCategory('tecnolog铆a', this)">Tecnolog铆a</div>
                    <div data-category="hogar" class="category-menu-original" onclick="filterByCategory('hogar', this)">Hogar</div>
                    <div data-category="herramientas" class="category-menu-original" onclick="filterByCategory('herramientas', this)">Herramientas</div>
                    
                    <div class="category-wrapper active" data-category="all" onclick="filterByCategory('all', this)">
                        <div class="category-icon-circle"><i class="fa-solid fa-list-ul"></i></div>
                        <span>Todos</span>
                    </div>
                    <div class="category-wrapper" data-category="tecnolog铆a" onclick="filterByCategory('tecnolog铆a', this)">
                        <div class="category-icon-circle"><i class="fa-solid fa-mobile-alt"></i></div>
                        <span>Electr贸nicos</span>
                    </div>
                    <div class="category-wrapper" data-category="juguetes" onclick="filterByCategory('juguetes', this)">
                        <div class="category-icon-circle"><i class="fa-solid fa-gamepad"></i></div>
                        <span>Juguetes</span>
                    </div>
                    <div class="category-wrapper" data-category="moda" onclick="filterByCategory('moda', this)">
                        <div class="category-icon-circle"><i class="fa-solid fa-tshirt"></i></div>
                        <span>Moda</span>
                    </div>
                    <div class="category-wrapper" data-category="herramientas" onclick="filterByCategory('herramientas', this)">
                        <div class="category-icon-circle"><i class="fa-solid fa-wrench"></i></div>
                        <span>Herramientas</span>
                    </div>
                    <div class="category-wrapper" data-category="hogar" onclick="filterByCategory('hogar', this)">
                        <div class="category-icon-circle"><i class="fa-solid fa-home"></i></div>
                        <span>Hogar</span>
                    </div>
                </div>
            </header>
            
            <div class="main-banner">
                </div>
            
            <div class="info-bar">
                <div class="info-item"><i class="fa-solid fa-truck icon"></i><span>ENVO maximo 5 dias</span></div>
                <div class="info-item"><i class="fa-solid fa-lock icon"></i><span>Garant铆a de entrega</span></div>
            </div>
            
            <main class="main-content">
                <h2 class="section-title"> Productos Destacados y Novedades</h2>
                <div id="product-list-container">
                    <p id="no-results-message" style="display: none; text-align: center; color: var(--color-gris-medio); padding: 30px 0;">No se encontraron productos que coincidan con su b煤squeda.</p>
                </div>
            </main>
        </div>


        <div id="product-detail-view">
             <div class="view-header">
                <i class="fa-solid fa-arrow-left" id="back-to-main"></i>
                <h3 style="flex-grow: 1; text-align: center; margin-left: -20px;">Detalle del Producto</h3>
                <div>
                    <i class="fa-solid fa-heart icon-btn" id="save-product-btn" style="font-size: 20px; padding: 10px; cursor: pointer; color: var(--color-gris-medio);"></i>
                    <i class="fa-solid fa-share-alt icon-btn" style="font-size: 20px; padding: 10px; cursor: pointer; color: var(--color-negro);"></i>
                </div>
            </div>
            
            <div class="detail-main-image-slider-wrapper" style="width: 100%; height: 300px; background-color: #f0f0f0; overflow: hidden; position: relative;">
                <img id="detail-main-image" src="" alt="Producto Principal" style="width: 100%; height: 100%; object-fit: cover; display: block; cursor: zoom-in;" onclick="openImageInFullScreen(this.src)">
                <button id="slider-prev-btn" style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); background-color: rgba(0,0,0,0.5); color: white; border: none; padding: 10px; border-radius: 50%; cursor: pointer; font-size: 18px; z-index: 10;">
                    <i class="fa-solid fa-chevron-left"></i>
                </button>
                <button id="slider-next-btn" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background-color: rgba(0,0,0,0.5); color: white; border: none; padding: 10px; border-radius: 50%; cursor: pointer; font-size: 18px; z-index: 10;">
                    <i class="fa-solid fa-chevron-right"></i>
                </button>
            </div>
            
            <div class="selection-section" style="padding: 15px;">
                <div class="detail-price-row" style="margin-bottom: 10px;">
                    <span class="detail-current-price price-value" id="detail-current-price" style="font-size: 24px; color: var(--color-primario); font-weight: 900;">$0.00</span>
                    <span class="detail-old-price" id="detail-old-price" style="font-size: 14px; color: var(--color-gris-medio); text-decoration: line-through; margin-left: 10px;">$0.00</span>
                    <span class="detail-discount-tag" id="detail-discount-tag" style="background-color: var(--color-secundario); color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px; margin-left: 10px; font-weight: bold;">0% DESC.</span>
                </div>
                <div class="detail-subtitle" style="font-size: 14px; color: var(--color-gris-medio);" id="detail-monthly-payment"></div>
                <div class="detail-title" id="detail-product-title" style="font-size: 18px; font-weight: bold; margin: 5px 0 10px;">T铆tulo</div>
                
                <div class="rating-seller-info" style="display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #333; padding-top: 10px;">
                    <div><span style="color: gold; font-weight: bold;"><i class="fa-solid fa-star"></i> 4.8</span></div>
                    <div><span id="detail-sales-count">855</span><span style="font-weight: bold; color: var(--color-gris-medio); font-size: 12px;"> ventas ></span></div>
                </div>
            </div>

            <div class="time-limited-offer selection-section" style="background-color: #fff; border-bottom: 1px solid #eee; padding: 15px;">
                <p style="font-weight: bold; color: var(--color-secundario); margin-bottom: 5px;"><i class="fa-solid fa-bolt"></i> Oferta por Tiempo Limitado</p>
                Termina en <span class="timer" id="detail-countdown-timer" style="font-weight: bold; color: var(--color-primario); font-size: 18px; margin-left: 5px;">00:00:00</span>
            </div>
            
            <div class="selection-section" style="border-bottom: 8px solid #f0f0f0; padding: 15px;">
                <div class="quantity-selector">
                    <h4 style="font-size: 16px; margin-bottom: 8px;">Cantidad</h4>
                    <div class="quantity-input-group" style="display: flex; align-items: center; gap: 10px;">
                        <button class="quantity-btn" onclick="changeQuantity(-1)" style="width: 30px; height: 30px; border-radius: 5px; background-color: #ccc; color: var(--color-negro); border: none;">-</button>
                        <input type="number" id="quantity-input" value="1" min="1" max="10" readonly style="width: 50px; text-align: center; background-color: #fff; color: var(--color-negro); border: 1px solid #ccc; padding: 5px; border-radius: 5px;">
                        <button class="quantity-btn" onclick="changeQuantity(1)" style="width: 30px; height: 30px; border-radius: 5px; background-color: #ccc; color: var(--color-negro); border: none;">+</button>
                    </div>
                </div>
            </div>
            
            <div class="detail-mid-info-bar selection-section" style="border-bottom: 8px solid #f0f0f0; display: flex; justify-content: space-around; text-align: center; padding: 15px;">
                <div style="font-size: 12px;"><i class="fa-solid fa-truck" style="color: var(--color-primario);"></i> Env铆o Puerta a Puerta </div>
                <div style="font-size: 12px;"><i class="fa-solid fa-undo" style="color: var(--color-primario);"></i> Devoluci贸n F谩cil</div>
                <div style="font-size: 12px;"><i class="fa-solid fa-shield-alt" style="color: var(--color-primario);"></i> Pago Seguro</div>
            </div>
            
            <div class="detail-description-container" style="padding: 15px;">
                <h4 style="font-size: 16px; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px;">Descripci贸n y Detalles</h4>
                <div id="detail-long-description" style="color: var(--color-negro); line-height: 1.5; font-size: 14px; margin-bottom: 20px;">Descripci贸n larga...</div>
                
                <h4 style="font-size: 16px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-top: 15px;">Galer铆a de Im谩genes</h4>
                <div id="detail-image-gallery" style="display: flex; flex-direction: column; gap: 15px; margin-top: 10px;">
                    </div>
            </div>

            <div class="selection-section" id="similar-products-section" style="padding: 15px; border-top: 8px solid var(--color-fondo-app); border-bottom: 8px solid var(--color-fondo-app);">
                <h4 style="font-size: 16px; margin-bottom: 15px;">Productos Similares Recomendados</h4>
                <div class="product-grid" id="similar-products-container">
                    </div>
            </div>
        </div>
        
        <div id="registration-view">
             <div class="view-header">
                <i class="fa-solid fa-arrow-left" onclick="handleNavClick('main')"></i>
                <h3>Registro de Perfil y Direcci贸n</h3>
            </div>
            <div style="padding: 15px;">
                 <h2 style="font-size: 20px; margin-bottom: 10px; color: var(--color-primario);">隆Bienvenido/a!</h2>
                 <p style="margin-bottom: 20px; color: var(--color-gris-medio);">Por favor, complete sus datos y la direcci贸n de env铆o para finalizar sus compras.</p>
                <form id="registration-form" style="display: flex; flex-direction: column; gap: 15px;">
                    <h4 style="border-bottom: 1px solid #eee; padding-bottom: 5px; margin-top: 10px;">Datos de Contacto</h4>
                    <input type="text" id="reg-name" placeholder="Nombre Completo" required>
                    <input type="tel" id="reg-phone" placeholder="Tel茅fono (ej: 7000-0000)" required>
                    <input type="email" id="reg-email" placeholder="Correo Electr贸nico" required>
                    <input type="password" id="reg-password" placeholder="Contrase帽a (M铆nimo 6 caracteres)" required>

                    <h4 style="border-bottom: 1px solid #eee; padding-bottom: 5px; margin-top: 10px;">Direcci贸n de Env铆o</h4>
                    <select id="reg-department" required style="padding: 10px; border: 1px solid #ccc; border-radius: 5px; background-color: #fff; color: var(--color-negro);">
                        <option value="">Seleccione Departamento</option>
                        <option value="San Salvador">San Salvador</option>
                        <option value="La Libertad">La Libertad</option>
                        <option value="Santa Ana">Santa Ana</option>
                    </select>
                    <input type="text" id="reg-municipality" placeholder="Municipio" required>
                    <input type="text" id="reg-colony" placeholder="Colonia/Barrio" required>
                    <input type="text" id="reg-street" placeholder="N掳 de Calle o Pasaje" required>
                    <input type="text" id="reg-color" placeholder="Color de Casa (ej: Azul, Casa 5b)" required>
                    <textarea id="reg-description" placeholder="Referencia Detallada (ej: Frente a la escuela, port贸n negro)" rows="3" required></textarea>
                    
                    <button type="submit" style="padding: 12px; font-size: 16px; border: none; border-radius: 25px; cursor: pointer; background-color: var(--color-primario); color: white; font-weight: bold; margin-top: 10px;">
                        Guardar Perfil y Direcci贸n
                    </button>
                </form>
            </div>
        </div>

        <div id="profile-view">
             <div class="view-header">
                <i class="fa-solid fa-arrow-left" onclick="handleNavClick('main')"></i>
                <h3>Mi Perfil y Direcci贸n</h3>
            </div>
             <div style="padding: 15px;">
                 <div id="profile-details" style="padding: 15px; background-color: var(--color-gris-claro); border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                    </div>
                 <button onclick="showRegistrationForm()" style="width: 100%; padding: 10px; margin-top: 20px; border: 1px solid var(--color-primario); background-color: transparent; color: var(--color-primario); border-radius: 25px; font-weight: bold; cursor: pointer;">
                    Editar Datos de Perfil y Direcci贸n
                 </button>
            </div>
        </div>
        
        <div id="saved-view">
             <div class="view-header">
                <i class="fa-solid fa-arrow-left" onclick="handleNavClick('main')"></i>
                <h3>Mis Productos Guardados</h3>
            </div>
            <div style="padding: 15px;">
                <p id="empty-saved-message" style="text-align: center; color: var(--color-gris-medio); padding: 30px;">A煤n no has guardado ning煤n producto. 隆Guarda tus favoritos!</p>
                <div id="saved-items-container" class="product-grid">
                    </div>
            </div>
        </div>

        <div id="cart-view">
            <div class="view-header">
                <i class="fa-solid fa-arrow-left" onclick="handleNavClick('main')"></i>
                <h3>Mi Carrito de Compras</h3>
            </div>
            <div style="padding: 15px;">
                <p id="empty-cart-message" style="text-align: center; color: var(--color-gris-medio); padding: 30px;">Tu carrito est谩 vac铆o. 隆A帽ade algunos productos!</p>
                <div id="cart-items-container" style="display: flex; flex-direction: column; gap: 15px;">
                    </div>
            </div>
            
            <div style="position: sticky; bottom: 0; background-color: var(--color-gris-claro); padding: 15px; border-top: 1px solid #eee; box-shadow: 0 -2px 10px rgba(0,0,0,0.05);">
                <div style="display: flex; justify-content: space-between; font-size: 18px; font-weight: bold; margin-bottom: 10px;">
                    <span>Total del Pedido:</span>
                    <span id="cart-total" style="color: var(--color-primario);">$0.00</span>
                </div>
                 <button onclick="checkout()" style="width: 100%; padding: 15px; font-size: 16px; border: none; border-radius: 25px; cursor: pointer; background-color: var(--color-primario); color: white; font-weight: bold;">
                    FINALIZAR COMPRA (PEDIR POR WHATSAPP)
                </button>
                <p style="font-size: 12px; text-align: center; color: var(--color-gris-medio); margin-top: 10px;">Ser谩 redirigido a WhatsApp con los detalles de su pedido y direcci贸n.</p>
            </div>
        </div>
        
        <div id="privacy-policy-view">
             <div class="view-header">
                <i class="fa-solid fa-arrow-left" onclick="handleNavClick('main')"></i>
                <h3>Pol铆tica de Privacidad</h3>
            </div>
            <div style="padding: 15px;">
                <h4 style="color: var(--color-primario); margin-bottom: 10px;">Recolecci贸n y Uso de Informaci贸n</h4>
                <p style="color: var(--color-negro); font-size: 14px;">Recopilamos su nombre, tel茅fono, correo electr贸nico y direcci贸n de env铆o a trav茅s del formulario de registro. Tambi茅n recopilamos datos de uso y del dispositivo (como el identificador de publicidad de su dispositivo) con el fin de mostrar anuncios personalizados y relevantes, medir la efectividad de las campa帽as y limitar la frecuencia de los anuncios. Estos datos se procesan de acuerdo con las pol铆ticas de privacidad de los proveedores de publicidad aplicables, y le recomendamos consultarlas. <br><br>3. Uso de la Informaci贸n: Utilizamos la informaci贸n recopilada para los siguientes prop贸sitos: a) Procesamiento de Pedidos: Su Nombre, Tel茅fono y Direcci贸n se utilizan para generar un mensaje pre-llenado de pedido en la plataforma de WhatsApp, que se env铆a directamente a nuestro equipo de ventas para finalizar su compra, gestionar el pago y coordinar la entrega. b) Publicidad: Mostrar anuncios personalizados y relevantes. c) Personalizaci贸n de la App: Usar sus datos locales de navegaci贸n (carrito, historial, preferencias) para mejorar su experiencia y sugerirle productos. <br><br>4. Compartici贸n y Divulgaci贸n de la Informaci贸n: No vendemos, alquilamos ni cedemos su informaci贸n personal de contacto a terceros para fines de marketing directo. Compartimos sus datos 煤nicamente de las siguientes maneras: a) Checkout a WhatsApp: Al iniciar el proceso de "Checkout", su informaci贸n de contacto (Nombre, Tel茅fono, Direcci贸n) se transfiere directamente a la plataforma de WhatsApp (<a href="https://wa.me/50375573427" target="_blank">https://wa.me/50375573427</a>) para que nuestro equipo de ventas pueda gestionar la orden. Al usar la funci贸n de Checkout, usted acepta expresamente esta transferencia de datos a WhatsApp. b) Proveedores de Publicidad: Compartimos datos de su dispositivo y uso con nuestros socios publicitarios para la prestaci贸n de sus servicios. c) Obligaci贸n Legal: Podemos divulgar su informaci贸n si as铆 lo exige la ley o en respuesta a solicitudes v谩lidas de autoridades p煤blicas. <br><br>5. Seguridad, Retenci贸n y Sus Derechos: La seguridad de los datos almacenados localmente depende de la seguridad de su dispositivo. Retenemos sus datos solo durante el tiempo necesario para los fines establecidos. Usted tiene derecho a acceder, modificar y actualizar su informaci贸n en la secci贸n de "Perfil" de la aplicaci贸n. Puede eliminar sus datos locales borrando los datos de la aplicaci贸n o desinstal谩ndola. Para optar por no recibir anuncios personalizados, puede desactivar o restablecer el identificador de publicidad en la configuraci贸n de su dispositivo. <br><br>6. Contacto: Si tiene preguntas o inquietudes sobre esta Pol铆tica o el manejo de sus datos, por favor cont谩ctenos a trav茅s de: juamsteven503@gmail.com. <br><br>7. Cambios a la Pol铆tica: Nos reservamos el derecho de actualizar esta Pol铆tica de Privacidad peri贸dicamente. Le notificaremos cualquier cambio publicando la nueva pol铆tica en esta p谩gina y actualizando la fecha de "Efectiva a partir de" en la parte superior.</p>
                <h4 style="color: var(--color-primario); margin-top: 20px; margin-bottom: 10px;">Seguridad</h4>
                <p style="color: var(--color-negro); font-size: 14px;">Aunque tomamos medidas razonables para proteger la informaci贸n personal, ning煤n m茅todo de transmisi贸n por Internet o almacenamiento electr贸nico es 100% seguro. Usamos un enlace seguro a WhatsApp para la finalizaci贸n de la compra.</p>
            </div>
        </div>

        <footer class="footer-nav">
            <a href="#" class="nav-item active" data-view="main" onclick="handleNavClick('main')"><i class="fa-solid fa-house"></i>Inicio</a>
            <a href="#" class="nav-item" data-view="saved" onclick="handleNavClick('saved')"><i class="fa-solid fa-heart"></i>Guardados</a>
            <a href="#" class="nav-item" data-view="profile" id="nav-profile-link" onclick="handleNavClick('profile')"><i class="fa-solid fa-user-circle"></i>T煤</a>
            <a href="#" class="nav-item" data-view="cart" onclick="handleNavClick('cart')">
                <div class="cart-icon-wrapper">
                    <i class="fa-solid fa-cart-shopping"></i>
                    <span class="cart-count" id="cart-count-badge">0</span>
                </div>
                Carrito
            </a>
        </footer>

        <div class="detail-info-footer" id="detail-footer" style="display: none;">
            <div class="price-box">
                <span id="footer-old-price" style="font-size: 12px; color: var(--color-gris-medio); text-decoration: line-through; margin-right: 5px;">$0.00</span>
                <span id="footer-current-price" class="price-value" style="font-size: 20px; font-weight: bold;">$0.00</span>
            </div>
            <button class="add-to-cart-btn" onclick="addToCart()">
                <span class="discount" id="footer-discount-tag" style="margin-right: 5px;">0% 隆AHORA!</span>
                隆Agrega al carrito!
            </button>
        </div>
        
        <div id="app-toast">Mensaje de prueba</div>
        
        <div id="full-screen-image-viewer" onclick="closeImageInFullScreen()" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; max-width: 420px; background-color: rgba(0, 0, 0, 0.9); z-index: 500; align-items: center; justify-content: center;">
            <img id="full-screen-image" src="" alt="Imagen Zoom" style="max-width: 90%; max-height: 90%; object-fit: contain;">
            <i class="fa-solid fa-times" style="position: absolute; top: 20px; right: 20px; color: white; font-size: 30px; cursor: pointer;"></i>
        </div>

    </div>

    <script>
        // --- CONSTANTES GLOBALES Y ESTADO ---
        const SELL_PRODUCT_URL = "https://www.ejemplodeventa.com"; // Enlace simulado
        let currentCategoryFilter = 'all'; 
        let currentProduct = null; 
        let cart = []; 
        let savedProducts = []; // NUEVO: Array para IDs de productos guardados
        let recentProducts = []; 
        let countdownInterval; 
        let currentImageIndex = 0; // NDICE DEL SLIDER DE IMAGEN PRINCIPAL
        
        // --- VISTAS ---
        const mainAppContent = document.getElementById('main-app-content');
        const productDetailView = document.getElementById('product-detail-view');
        const registrationView = document.getElementById('registration-view');
        const profileView = document.getElementById('profile-view');
        const cartView = document.getElementById('cart-view');
        const privacyPolicyView = document.getElementById('privacy-policy-view');
        const savedView = document.getElementById('saved-view'); // NUEVA VISTA
        const detailFooter = document.getElementById('detail-footer');
        const sideMenu = document.getElementById('side-menu');
        const menuOverlay = document.getElementById('menu-overlay');
        const sliderPrevBtn = document.getElementById('slider-prev-btn');
        const sliderNextBtn = document.getElementById('slider-next-btn');

        // --- BASE DE DATOS DE PRODUCTOS (SIMULADA) ---
        const PRODUCT_DATA = [
            { 
                id: 1, 
                title: "Katana japonesa", 
                price: 9.99, 
                oldPrice: 70.00, 
                sales: '2.5K+', 
                monthlyPayment: '1 cuotas de $9.99', 
                basePrice: 9.99, 
                discount: 85.73, 
                isHidden: false, 
                categories: ['juguetes', 'coleccionables'],
                images: ["1762649958503.jpg", "1762650273063.jpg", "t铆tulo_20251206170116.png"], 
                longDescription: `<p>Imitacion o replica de katana japonesa roja y negro ,echa a mano con acero de bajo carbono ,mango de metal con envoltura de tela y encintado de algodon con poliester,mango desarmable,medida 70cm ,oja de 55 cm mango de 15 cm,sin filo   .</p><p>Incluye funda de madera forrada con tela de poliester con correa para decoracion`,
            },
            { 
                id: 2, 
                title: "Camiseta Deportiva 'CoolFit' (Tallas S-XL)", 
                price: 15.99, 
                oldPrice: 19.99, 
                sales: '800+', 
                monthlyPayment: '1 cuota de $15.99', 
                basePrice: 15.99, 
                discount: 20.01, 
                isHidden: false, 
                categories: ['moda', 'deporte'], 
                images: ["https://picsum.photos/300/300?random=3", "https://picsum.photos/300/300?random=4", "https://picsum.photos/300/300?random=33"], 
                longDescription: `<p>Tela transpirable de secado r谩pido. Perfecta para el gimnasio o actividades al aire libre. Disponible en colores azul y negro.</p><p>100% poli茅ster.`,
            },
            { 
                id: 3, 
                title: "Set de Sartenes Antiadherentes (3 Piezas)", 
                price: 35.00, 
                oldPrice: 40.00, 
                sales: '1.2K+', 
                monthlyPayment: '3 cuotas de $11.67', 
                basePrice: 35.00, 
                discount: 12.5, 
                isHidden: false, 
                categories: ['hogar', 'cocina'], 
                images: ["https://picsum.photos/300/300?random=5", "https://picsum.photos/300/300?random=6", "https://picsum.photos/300/300?random=55", "https://picsum.photos/300/300?random=66"], 
                longDescription: `<p>Set esencial de sartenes de alta calidad. Resistentes y f谩ciles de limpiar. Incluye tama帽os: 20cm, 24cm y 28cm.</p><p>Ideal para cocinas de inducci贸n y gas. 隆Cocina sin que se pegue nada!`,
            },
            { 
                id: 4, 
                title: "Zapatillas Deportivas Ultra Light", 
                price: 45.00, 
                oldPrice: 50.00, 
                sales: '1.5K+', 
                monthlyPayment: '3 cuotas de $15.00', 
                basePrice: 45.00, 
                discount: 10.0, 
                isHidden: false, 
                categories: ['moda', 'deporte'], 
                images: ["https://picsum.photos/300/300?random=7", "https://picsum.photos/300/300?random=8"], 
                longDescription: `<p>Comodidad y estilo en un solo par. Ideales para correr o el uso diario. Material transpirable y suela antideslizante.</p><p>Disponibles en tallas 7 a 11.`,
            },
            { 
                id: 5, 
                title: "Smartwatch Deportivo Pro", 
                price: 99.99, 
                oldPrice: 130.00, 
                sales: '2.1K+', 
                monthlyPayment: '3 cuotas de $33.33', 
                basePrice: 99.99, 
                discount: 23.08, 
                isHidden: false, 
                categories: ['tecnolog铆a', 'deporte'], 
                images: ["https://picsum.photos/300/300?random=9", "https://picsum.photos/300/300?random=10"], 
                longDescription: `<p>Monitor de ritmo card铆aco, GPS y bater铆a de larga duraci贸n. Compatible con iOS y Android. Ideal para tracking de fitness.</p><p>Resistente al agua (IP68).`,
            },
            { 
                id: 6, 
                title: "Mu帽eca de Colecci贸n 'Princesa Estelar'", 
                price: 18.50, 
                oldPrice: 20.00, 
                sales: '450+', 
                monthlyPayment: '1 cuota de $18.50', 
                basePrice: 18.50, 
                discount: 7.5, 
                isHidden: false, 
                categories: ['juguetes', 'coleccionables'], 
                images: ["https://picsum.photos/300/300?random=11"], 
                longDescription: `<p>Mu帽eca articulada con accesorios de lujo. Edici贸n limitada con vestido brillante. Recomendado para mayores de 6 a帽os.</p>`,
            },
            { 
                id: 7, 
                title: "Destornillador El茅ctrico Recargable", 
                price: 39.99, 
                oldPrice: 45.00, 
                sales: '900+', 
                monthlyPayment: '3 cuotas de $13.33', 
                basePrice: 39.99, 
                discount: 11.13, 
                isHidden: false, 
                categories: ['herramientas', 'electricidad'], 
                images: ["https://picsum.photos/300/300?random=12"], 
                longDescription: `<p>Potente destornillador con bater铆a de litio. Incluye 12 puntas intercambiables y luz LED integrada. Perfecto para el hogar.</p>`,
            },
            { 
                id: 8, 
                title: "Pantal贸n de Jeans Slim Fit Hombre", 
                price: 29.99, 
                oldPrice: 35.00, 
                sales: '1.1K+', 
                monthlyPayment: '2 cuotas de $15.00', 
                basePrice: 29.99, 
                discount: 14.31, 
                isHidden: false, 
                categories: ['moda'], 
                images: ["https://picsum.photos/300/300?random=13", "https://picsum.photos/300/300?random=13b"], 
                longDescription: `<p>Jeans de corte Slim Fit, c贸modos y modernos. Material el谩stico de alta durabilidad. Disponible en colores: azul oscuro, negro.</p>`,
            },
            { 
                id: 9, 
                title: "Router Wi-Fi Mesh Doble Banda", 
                price: 120.00, 
                oldPrice: 150.00, 
                sales: '500+', 
                monthlyPayment: '3 cuotas de $40.00', 
                basePrice: 120.00, 
                discount: 20.0, 
                isHidden: false, 
                categories: ['tecnolog铆a', 'redes'], 
                images: ["https://picsum.photos/300/300?random=14"], 
                longDescription: `<p>Cubre hasta 200m虏 con una se帽al Wi-Fi estable y r谩pida. Ideal para hogares con m煤ltiples dispositivos conectados. Configuraci贸n sencilla.</p>`,
            },
            { 
                id: 10, 
                title: "Alfombra Persa de Lana (2x3 metros)", 
                price: 89.99, 
                oldPrice: 110.00, 
                sales: '300+', 
                monthlyPayment: '3 cuotas de $30.00', 
                basePrice: 89.99, 
                discount: 18.19, 
                isHidden: false, 
                categories: ['hogar', 'decoraci贸n'], 
                images: ["https://picsum.photos/300/300?random=15", "https://picsum.photos/300/300?random=15b"], 
                longDescription: `<p>Dise帽o cl谩sico y elegante. Hecha con lana de alta calidad, suave al tacto y resistente. Perfecta para sal贸n o comedor.</p>`,
            },
            { 
                id: 11, 
                title: "Set de Manicura y Pedicura Profesional", 
                price: 12.99, 
                oldPrice: 15.00, 
                sales: '600+', 
                monthlyPayment: '1 cuota de $12.99', 
                basePrice: 12.99, 
                discount: 13.4, 
                isHidden: false, 
                categories: ['moda', 'belleza'], 
                images: ["https://picsum.photos/300/300?random=16"], 
                longDescription: `<p>Kit completo con 15 herramientas de acero inoxidable. Ideal para el cuidado personal en casa o profesional.</p>`,
            },
            { 
                id: 12, 
                title: "Kit de Robot de Construcci贸n Educativo", 
                price: 55.00, 
                oldPrice: 60.00, 
                sales: '750+', 
                monthlyPayment: '3 cuotas de $18.33', 
                basePrice: 55.00, 
                discount: 8.33, 
                isHidden: false, 
                categories: ['juguetes', 'educativo'], 
                images: ["https://picsum.photos/300/300?random=17"], 
                longDescription: `<p>Aprende sobre programaci贸n y rob贸tica de forma divertida. Incluye motor y sensores. Requiere 2 pilas AA (no incluidas).</p>`,
            },
            { 
                id: 13, 
                title: "Juego de Cuchillos de Chef (6 Piezas)", 
                price: 49.99, 
                oldPrice: 60.00, 
                sales: '950+', 
                monthlyPayment: '3 cuotas de $16.66', 
                basePrice: 49.99, 
                discount: 16.68, 
                isHidden: false, 
                categories: ['hogar', 'cocina'], 
                images: ["https://picsum.photos/300/300?random=18"], 
                longDescription: `<p>Cuchillos de acero inoxidable de alto carbono. Mango ergon贸mico para un agarre seguro. Bloque de madera incluido.</p>`,
            },
            { 
                id: 14, 
                title: "Martillo de U帽a Curva", 
                price: 9.99, 
                oldPrice: 12.00, 
                sales: '1.2K+', 
                monthlyPayment: '1 cuota de $9.99', 
                basePrice: 9.99, 
                discount: 16.75, 
                isHidden: false, 
                categories: ['herramientas'], 
                images: ["https://picsum.photos/300/300?random=19", "https://picsum.photos/300/300?random=19b"], 
                longDescription: `<p>Martillo de 16 oz con cabeza de acero forjado. Mango de fibra de vidrio para reducir la vibraci贸n. Calidad profesional.</p>`,
            },
            { 
                id: 15, 
                title: "Mochila Antirrobo para Laptop", 
                price: 34.99, 
                oldPrice: 40.00, 
                sales: '1.8K+', 
                monthlyPayment: '2 cuotas de $17.50', 
                basePrice: 34.99, 
                discount: 12.53, 
                isHidden: false, 
                categories: ['tecnolog铆a', 'moda'], 
                images: ["https://picsum.photos/300/300?random=20"], 
                longDescription: `<p>Mochila con dise帽o ergon贸mico y sistema antirrobo oculto. Bolsillo para laptop de hasta 15.6 pulgadas y puerto USB de carga.</p>`,
            },
            { 
                id: 16, 
                title: "Lentes de Sol Polarizados UV400", 
                price: 22.00, 
                oldPrice: 28.00, 
                sales: '700+', 
                monthlyPayment: '1 cuota de $22.00', 
                basePrice: 22.00, 
                discount: 21.43, 
                isHidden: false, 
                categories: ['moda', 'accesorios'], 
                images: ["https://picsum.photos/300/300?random=21"], 
                longDescription: `<p>Protecci贸n total UV400 y lentes polarizados para reducir el deslumbramiento. Marco ligero y resistente. Estilo unisex.</p>`,
            },
            { 
                id: 17, 
                title: "Juego de Carros a Control Remoto", 
                price: 28.00, 
                oldPrice: 32.00, 
                sales: '500+', 
                monthlyPayment: '2 cuotas de $14.00', 
                basePrice: 28.00, 
                discount: 12.5, 
                isHidden: false, 
                categories: ['juguetes'], 
                images: ["https://picsum.photos/300/300?random=17b"], 
                longDescription: `<p>Set de dos carros de carreras a escala con control remoto de 2.4GHz. Bater铆as recargables incluidas. Ideal para competir con amigos.</p>`,
            },
            { 
                id: 18, 
                title: "Set de Brocas y Puntas para Taladro", 
                price: 19.99, 
                oldPrice: 25.00, 
                sales: '850+', 
                monthlyPayment: '1 cuota de $19.99', 
                basePrice: 19.99, 
                discount: 20.04, 
                isHidden: false, 
                categories: ['herramientas'], 
                images: ["https://picsum.photos/300/300?random=19c"], 
                longDescription: `<p>Juego de 50 piezas para perforar y atornillar. Incluye estuche organizador. Acero de alta velocidad (HSS).</p>`,
            },
            { 
                id: 19, 
                title: "Pijama de Seda para Mujer", 
                price: 32.00, 
                oldPrice: 40.00, 
                sales: '400+', 
                monthlyPayment: '2 cuotas de $16.00', 
                basePrice: 32.00, 
                discount: 20.0, 
                isHidden: false, 
                categories: ['moda', 'ropa'], 
                images: ["https://picsum.photos/300/300?random=13c"], 
                longDescription: `<p>Pijama de dos piezas, suave y lujosa, ideal para un descanso confortable. Disponible en tallas S, M, L.</p>`,
            },
            { 
                id: 20, 
                title: "Batidora de Mano El茅ctrica", 
                price: 28.50, 
                oldPrice: 35.00, 
                sales: '600+', 
                monthlyPayment: '2 cuotas de $14.25', 
                basePrice: 28.50, 
                discount: 18.57, 
                isHidden: false, 
                categories: ['hogar', 'cocina'], 
                images: ["https://picsum.photos/300/300?random=5b", "https://picsum.photos/300/300?random=5c"], 
                longDescription: `<p>Batidora con 5 velocidades y funci贸n turbo. Incluye ganchos para masa y batidores. Potencia de 300W.</p>`,
            },
            { 
                id: 21, 
                title: "Tablet 10 Pulgadas HD", 
                price: 150.00, 
                oldPrice: 180.00, 
                sales: '900+', 
                monthlyPayment: '3 cuotas de $50.00', 
                basePrice: 150.00, 
                discount: 16.67, 
                isHidden: false, 
                categories: ['tecnolog铆a', 'port谩tiles'], 
                images: ["https://picsum.photos/300/300?random=20b", "https://picsum.photos/300/300?random=20c"], 
                longDescription: `<p>Pantalla HD de 10.1", 4GB de RAM y 64GB de almacenamiento (expandible). Bater铆a de larga duraci贸n. Perfecta para multimedia.</p>`,
            },
            { 
                id: 22, 
                title: "Mesa de Centro Industrial", 
                price: 65.00, 
                oldPrice: 80.00, 
                sales: '500+', 
                monthlyPayment: '3 cuotas de $21.67', 
                basePrice: 65.00, 
                discount: 18.75, 
                isHidden: false, 
                categories: ['hogar', 'muebles'], 
                images: ["https://picsum.photos/300/300?random=22", "https://picsum.photos/300/300?random=22b"], 
                longDescription: `<p>Mesa de centro con dise帽o minimalista e industrial. Tapa de madera y patas de metal reforzado. Ideal para salas modernas.</p>`
            }
            ,
            { 
                id: 23, 
                title: "Set de Ladrillos Magn茅ticos", 
                price: 29.99, 
                oldPrice: 35.00, 
                sales: '700+', 
                monthlyPayment: '3 cuotas de $10.00', 
                basePrice: 29.99, 
                discount: 14.3, 
                isHidden: false, 
                categories: ['juguetes', 'educativo'], 
                images: ["https://picsum.photos/300/300?random=23", "https://picsum.photos/300/300?random=23b", "https://picsum.photos/300/300?random=23c"], 
                longDescription: `<p>Juego de construcci贸n magn茅tico para el desarrollo creativo y motor de los ni帽os. Incluye 50 piezas de colores.</p>`
            },
            { 
                id: 24, 
                title: "Llave Ajustable de Cromo Vanadio", 
                price: 14.50, 
                oldPrice: 16.00, 
                sales: '2K+', 
                monthlyPayment: '1 cuota de $14.50', 
                basePrice: 14.50, 
                discount: 9.4, 
                isHidden: false, 
                categories: ['herramientas'], 
                images: ["https://picsum.photos/300/300?random=24", "https://picsum.photos/300/300?random=24b", "https://picsum.photos/300/300?random=24c"], 
                longDescription: `<p>Llave de alta resistencia con apertura de boca ajustable. Indispensable en cualquier caja de herramientas.</p>`
            }
        ]; 

        // --- 1. CONFIGURACIN INICIAL Y UTILITIES ---
        function formatCurrency(amount) {
            return new Intl.NumberFormat('es-SV', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2
            }).format(amount);
        }

        function calculateDiscount(currentPrice, oldPrice) {
            if (oldPrice > currentPrice && oldPrice > 0) {
                return Math.round(((oldPrice - currentPrice) / oldPrice) * 100);
            }
            return 0;
        }

        // --- FUNCIONES DE PERSISTENCIA (CART & RECENT PRODUCTS & SAVED) ---
        function saveCart() {
            localStorage.setItem('shoppingCart', JSON.stringify(cart));
        }

        function loadCart() {
            const savedCart = localStorage.getItem('shoppingCart');
            cart = savedCart ? JSON.parse(savedCart) : [];
            updateCartBadge();
        }

        function updateCartBadge() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const badge = document.getElementById('cart-count-badge');
            if (badge) {
                badge.textContent = totalItems;
            }
        }

        function loadRecentProducts() {
            const savedProducts = localStorage.getItem('recentProducts');
            if (savedProducts) {
                const savedIds = JSON.parse(savedProducts);
                recentProducts = savedIds.map(id => PRODUCT_DATA.find(p => p.id === id)).filter(p => p !== undefined);
            }
        }
        
        // NUEVAS FUNCIONES DE PERSISTENCIA DE GUARDADOS
        function saveSavedProducts() {
            localStorage.setItem('savedProducts', JSON.stringify(savedProducts));
        }

        function loadSavedProducts() {
            const saved = localStorage.getItem('savedProducts');
            savedProducts = saved ? JSON.parse(saved) : [];
        }

        function saveRecentProducts() {
            const productIds = recentProducts.map(p => p.id);
            localStorage.setItem('recentProducts', JSON.stringify(productIds));
        }
        // --- FIN PERSISTENCIA ---

        // --- 3. LGICA DE VISTAS Y NAVEGACIN ---
        function showToast(message) {
            const toast = document.getElementById('app-toast');
            if (!toast) return;

            clearTimeout(toast.timeoutId);
            toast.classList.remove('show');

            setTimeout(() => {
                toast.textContent = message;
                toast.classList.add('show');
                toast.timeoutId = setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }, 50);
        }

        function hideAllViews() {
            [mainAppContent, productDetailView, registrationView, profileView, cartView, privacyPolicyView, savedView].forEach(view => {
                view.style.display = 'none';
            });
            detailFooter.style.display = 'none'; 
            document.querySelectorAll('.footer-nav .nav-item').forEach(item => {
                item.classList.remove('active');
            });
        }

        window.handleNavClick = function(viewName) {
            hideAllViews();
            let targetView;
            let navItem;

            switch (viewName) {
                case 'main':
                    targetView = mainAppContent;
                    navItem = document.querySelector('.footer-nav .nav-item[data-view="main"]');
                    renderProducts(PRODUCT_DATA); 
                    break;
                case 'profile':
                    showProfileView();
                    navItem = document.querySelector('.footer-nav .nav-item[data-view="profile"]');
                    return; 
                case 'cart':
                    showCartView();
                    navItem = document.querySelector('.footer-nav .nav-item[data-view="cart"]');
                    return; 
                case 'saved': // NUEVO: Navegaci贸n a Guardados
                    showSavedView();
                    navItem = document.querySelector('.footer-nav .nav-item[data-view="saved"]');
                    return;
                default:
                    return;
            }

            if (targetView) {
                targetView.style.display = 'flex'; 
                if (navItem) {
                    navItem.classList.add('active');
                }
            }
        }
        
        window.openImageInFullScreen = function(src) {
            const viewer = document.getElementById('full-screen-image-viewer');
            document.getElementById('full-screen-image').src = src;
            viewer.style.display = 'flex';
            document.body.style.overflow = 'hidden'; 
        }

        window.closeImageInFullScreen = function() {
            document.getElementById('full-screen-image-viewer').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        // FIX: Se garantiza que el men煤 lateral se abra/cierre correctamente.
        window.toggleSideMenu = function() {
            const isOpen = sideMenu.classList.contains('open');
            sideMenu.classList.toggle('open', !isOpen);
            menuOverlay.style.display = isOpen ? 'none' : 'block';
        }

        window.handleMenuClick = function(action) {
            toggleSideMenu(); 
            if (action === 'main') {
                handleNavClick('main');
            } else if (action === 'profile') {
                handleNavClick('profile');
            } else if (action === 'cart') {
                handleNavClick('cart');
            } else if (action === 'saved') {
                handleNavClick('saved');
            } else if (action === 'sell') {
                window.open(SELL_PRODUCT_URL, '_blank');
                showToast(" Abriendo enlace para Vender Productos...");
            } else if (action === 'support') {
                const emailAddress = "juamsteven503@gmail.com";
                window.location.href = `mailto:${emailAddress}?subject=Solicitud de Soporte desde la App M贸vil`;
            } else if (action === 'privacy') {
                hideAllViews();
                privacyPolicyView.style.display = 'block';
            } else if (action === 'logout') {
                logout();
            }
        }

        window.openSellLink = function() {
            window.open(SELL_PRODUCT_URL, '_blank');
            showToast(" Abriendo enlace para Vender Aqu铆...");
        };
        // --- FIN LGICA DE VISTAS ---

        // --- 4. LGICA DE FILTRADO Y PRODUCTOS ---
        const productListContainer = document.getElementById('product-list-container');
        const noResultsMessage = document.getElementById('no-results-message');

        function createProductCardHTML(product) {
            const isFreeShipping = product.oldPrice > 50; 
            return `
                <div class="product-card product-link" data-product-id="${product.id}" onclick="showProductDetail(${product.id})">
                    <img src="${product.images[0]}" alt="${product.title}">
                    <div class="product-details">
                        <p style="font-size: 13px; margin-bottom: 5px; color: var(--color-negro);">${product.title.substring(0, 35)}${product.title.length > 35 ? '...' : ''}</p>
                        <div style="font-size: 10px; color: gold;">
                            <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star-half-stroke"></i>
                            <span style="color: var(--color-gris-medio); margin-left: 5px;">(4.5)</span>
                        </div>
                        <div class="product-price" style="margin-top: 5px;">
                            <span class="current-price">${formatCurrency(product.price)}</span>
                            <span class="old-price">${formatCurrency(product.oldPrice)}</span>
                        </div>
                        <div style="margin-top: 5px; min-height: 20px;">
                             <span class="tag-black-friday">${product.discount.toFixed(0)}% OFF</span>
                             ${isFreeShipping ? `<span class="free-shipping-tag">ENVO GRATIS</span>` : ''}
                        </div>
                        <button class="add-to-cart-grid-btn" onclick="addToCartGrid(event, ${product.id})">
                             <i class="fa-solid fa-cart-plus"></i>
                        </button>
                    </div>
                </div>
            `;
        }

        function createFlashSaleItemHTML(product) {
            return `
                <div class="flash-item-card product-link" data-product-id="${product.id}" onclick="showProductDetail(${product.id})">
                    <img src="${product.images[0]}" alt="${product.title}">
                    <div class="item-details">
                        <div class="title">${product.title.substring(0, 25)}${product.title.length > 25 ? '...' : ''}</div>
                        <div class="price">${formatCurrency(product.price)}</div>
                        <span class="tag-black-friday">${product.discount.toFixed(0)}% DESC.</span>
                        <button class="add-to-cart-grid-btn" onclick="addToCartGrid(event, ${product.id})" style="margin-top: 5px; padding: 3px 0; font-size: 12px;">
                             <i class="fa-solid fa-cart-plus"></i>
                        </button>
                    </div>
                </div>
            `;
        }

        function getPersonalizedProducts(products, preferredCategory) {
            if (!preferredCategory || preferredCategory === 'all') {
                return [...products].sort(() => 0.5 - Math.random());
            }

            const preferredProducts = products.filter(p => p.categories.includes(preferredCategory));
            const otherProducts = products.filter(p => !p.categories.includes(preferredCategory));

            preferredProducts.sort(() => 0.5 - Math.random());
            otherProducts.sort(() => 0.5 - Math.random());

            const finalProducts = [];
            let i = 0; 
            let j = 0; 
            let preferredCount = 0; 

            while (i < preferredProducts.length || j < otherProducts.length) {
                if (i < preferredProducts.length && preferredCount < 2) {
                    finalProducts.push(preferredProducts[i++]);
                    preferredCount++;
                } 
                else if (j < otherProducts.length) {
                    finalProducts.push(otherProducts[j++]);
                    preferredCount = 0; 
                } 
                else if (i < preferredProducts.length) {
                    finalProducts.push(preferredProducts[i++]);
                } 
                else if (j < otherProducts.length) {
                    finalProducts.push(otherProducts[j++]);
                }
            }
            return finalProducts;
        }


        function renderProducts(products = PRODUCT_DATA, isSearching = false) {
            productListContainer.innerHTML = '';
            const preferredCategory = localStorage.getItem('userLastViewedCategory');
            let finalProducts = products;

            if (!isSearching && currentCategoryFilter === 'all') {
                finalProducts = getPersonalizedProducts(products, preferredCategory);
            } else if (!isSearching && currentCategoryFilter !== 'all') {
                finalProducts = products.filter(p => p.categories.includes(currentCategoryFilter));
            }
            
            if (isSearching) {
                document.querySelector('.section-title').textContent = ` Resultados para "${document.getElementById('search-input').value.trim()}"`;
            } else {
                document.querySelector('.section-title').textContent = ' Productos Destacados y Novedades';
            }

            if (finalProducts.length === 0) {
                noResultsMessage.style.display = 'block';
                return;
            } else {
                noResultsMessage.style.display = 'none';
            }

            if (!isSearching && currentCategoryFilter === 'all') {
                const aggressiveOffers = PRODUCT_DATA.filter(p => p.oldPrice > p.basePrice).sort(() => 0.5 - Math.random()).slice(0, 10);
                const flashSaleContent = `
                    <div class="flash-liquidation-dynamic" style="margin-bottom: 20px; padding: 0 5px;">
                        <h4 class="section-title" style="font-size: 18px; margin-bottom: 10px; border-left-color: var(--color-secundario); color: var(--color-secundario);">
                             <i class="fa-solid fa-fire"></i> 隆OFERTAS AGRESIVAS! 
                             <span style="font-size: 12px; margin-left: 10px; color: var(--color-gris-medio); font-weight: 400;">(Liquidaci贸n R谩pida)</span>
                        </h4>
                        <div class="flash-product-strip">
                            ${aggressiveOffers.map(createFlashSaleItemHTML).join('')}
                        </div>
                    </div>
                `;
                productListContainer.innerHTML += flashSaleContent;
            }


            const gridContent = `
                <div class="product-grid">
                    ${finalProducts.map(createProductCardHTML).join('')}
                </div>
            `;
            productListContainer.innerHTML += gridContent;
        }

        window.filterByCategory = function(category, element) {
            const normalizedKeyword = category.toLowerCase();
            currentCategoryFilter = normalizedKeyword;

            // ACTUALIZA LA CLASE ACTIVA DEL MEN SUPERIOR
            document.querySelectorAll('.category-wrapper').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-category') === normalizedKeyword) {
                    item.classList.add('active'); 
                }
            });

            let filteredProducts = normalizedKeyword === 'all' 
                ? PRODUCT_DATA 
                : PRODUCT_DATA.filter(p => p.categories.includes(normalizedKeyword));
            
            renderProducts(filteredProducts);
            
            document.getElementById('search-input').value = '';
        }

        window.handleSearch = function() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase().trim();

            if (searchTerm.length > 0) {
                currentCategoryFilter = 'search';

                const filteredProducts = PRODUCT_DATA.filter(p => 
                    p.title.toLowerCase().includes(searchTerm) || 
                    p.longDescription.toLowerCase().includes(searchTerm) || 
                    p.categories.some(cat => cat.toLowerCase().includes(searchTerm))
                );

                renderProducts(filteredProducts, true);
            } else {
                currentCategoryFilter = 'all';
                renderProducts(PRODUCT_DATA);
            }
        }
        // --- 5. LGICA DE DETALLE DE PRODUCTO ---

        // FUNCIN DEL SLIDER DE IMAGEN PRINCIPAL
        function showSliderImage(index) {
            const images = currentProduct.images;
            if (!images || images.length === 0) return;

            let newIndex = index;
            if (newIndex < 0) {
                newIndex = images.length - 1; // Circular: ir a la 煤ltima imagen
            } else if (newIndex >= images.length) {
                newIndex = 0; // Circular: ir a la primera imagen
            }
            
            currentImageIndex = newIndex;
            document.getElementById('detail-main-image').src = images[currentImageIndex];
            
            // Opcional: mostrar un indicador de 铆ndice (ej. "1/4")
            // Si no hay un indicador, este paso se ignora.
        }

        window.startCountdownTimer = function(hoursDuration) {
            const timerDisplay = document.getElementById('detail-countdown-timer');
            let totalSeconds = hoursDuration * 3600;

            if (countdownInterval) {
                clearInterval(countdownInterval);
            }

            function updateTimer() {
                const h = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
                const m = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
                const s = String(totalSeconds % 60).padStart(2, '0');
                timerDisplay.textContent = `${h}:${m}:${s}`;

                if (totalSeconds <= 0) {
                    clearInterval(countdownInterval);
                    timerDisplay.textContent = "隆Tiempo terminado!";
                }
                totalSeconds--;
            }
            updateTimer();
            countdownInterval = setInterval(updateTimer, 1000);
        }

        function renderSimilarProducts(currentProduct) {
            const similarContainer = document.getElementById('similar-products-container');
            similarContainer.innerHTML = '';
            
            const category = currentProduct.categories ? currentProduct.categories[0] : 'all'; 
            
            const similarProducts = PRODUCT_DATA.filter(p => 
                p.id !== currentProduct.id && 
                p.categories && 
                p.categories.includes(category)
            ).sort(() => 0.5 - Math.random()).slice(0, 4);

            if (similarProducts.length > 0) {
                document.getElementById('similar-products-section').style.display = 'block';
                similarProducts.forEach(product => {
                    similarContainer.innerHTML += createProductCardHTML(product);
                });
            } else {
                document.getElementById('similar-products-section').style.display = 'none';
            }
        }
        
        // FUNCIN ACTUALIZADA: Renderiza la galer铆a de im谩genes (Grandes, apiladas)
        function renderImageGallery(images) {
            const gallery = document.getElementById('detail-image-gallery');
            gallery.innerHTML = '';
            
            images.forEach((src, index) => {
                const imgDiv = document.createElement('div');
                
                // Estilo para imagen grande (full-width) y apilada
                imgDiv.style.width = '100%'; 
                imgDiv.style.marginBottom = '15px'; 
                imgDiv.style.borderRadius = '8px';
                imgDiv.style.overflow = 'hidden';
                imgDiv.style.cursor = 'zoom-in';
                imgDiv.style.boxShadow = '0 2px 5px rgba(0,0,0,0.1)';
                
                imgDiv.innerHTML = `
                    <img src="${src}" alt="Imagen ${index + 1}" 
                         style="width: 100%; height: auto; display: block;" 
                         onclick="openImageInFullScreen(this.src)">
                `;
                gallery.appendChild(imgDiv);
            });
        }

        window.showProductDetail = function(productId) {
            const product = PRODUCT_DATA.find(p => p.id === productId);
            if (!product) {
                showToast(" Producto no encontrado.");
                return;
            }
            currentProduct = product; 

            if (product.categories && product.categories.length > 0) {
                localStorage.setItem('userLastViewedCategory', product.categories[0]);
            }

            if (!recentProducts.some(p => p.id === productId)) {
                recentProducts.unshift(product);
                if (recentProducts.length > 5) recentProducts.pop();
                saveRecentProducts();
            }

            hideAllViews();
            productDetailView.style.display = 'block';
            detailFooter.style.display = 'flex'; 

            // --- Rellenar datos y precios ---
            document.getElementById('detail-product-title').textContent = product.title;
            document.getElementById('detail-monthly-payment').textContent = product.monthlyPayment || '';
            document.getElementById('detail-sales-count').textContent = product.sales;
            document.getElementById('detail-long-description').innerHTML = product.longDescription;

            const currentPriceText = formatCurrency(product.price); 
            const oldPriceText = formatCurrency(product.oldPrice);
            const discount = product.discount.toFixed(0);

            document.getElementById('detail-current-price').textContent = currentPriceText;
            document.getElementById('detail-old-price').textContent = oldPriceText;
            document.getElementById('detail-discount-tag').textContent = `${discount}% DESC.`;

            document.getElementById('footer-current-price').textContent = currentPriceText;
            document.getElementById('footer-old-price').textContent = oldPriceText;
            document.getElementById('footer-discount-tag').textContent = `${discount}% 隆AHORA!`;
            
            document.getElementById('quantity-input').value = 1;

            // --- IMGENES Y GALERA ---
            currentImageIndex = 0; // Resetear el 铆ndice al entrar
            showSliderImage(currentImageIndex); // Mostrar la primera imagen en el slider
            renderImageGallery(product.images); // Renderizar todas las im谩genes grandes abajo

            // --- BOTN DE GUARDAR ---
            updateSaveButtonState(productId); 
            document.getElementById('save-product-btn').onclick = () => toggleSavedStatus(productId);


            startCountdownTimer(4); 
            renderSimilarProducts(product);
        }

        window.changeQuantity = function(delta) {
            const input = document.getElementById('quantity-input');
            let quantity = parseInt(input.value) || 1;
            quantity += delta;
            if (quantity < 1) quantity = 1;
            if (quantity > 10) quantity = 10; 
            input.value = quantity;
        }

        window.addToCart = function() {
            if (!currentProduct) {
                showToast(" No hay producto seleccionado.");
                return;
            }
            const quantityInput = document.getElementById('quantity-input');
            const quantity = parseInt(quantityInput.value) || 1;
            const priceToUse = currentProduct.basePrice; 

            const existingItemIndex = cart.findIndex(item => item.id === currentProduct.id);

            if (existingItemIndex > -1) {
                cart[existingItemIndex].quantity += quantity;
                cart[existingItemIndex].price = priceToUse;
            } else {
                cart.push({
                    id: currentProduct.id,
                    title: currentProduct.title,
                    price: priceToUse,
                    image: currentProduct.images[0],
                    quantity: quantity
                });
            }

            saveCart();
            updateCartBadge();
            showToast(` 隆${quantity} unidad(es) de ${currentProduct.title.substring(0, 20)}... agregado(s)!`);
        }
        
        window.addToCartGrid = function(event, productId) {
            event.stopPropagation();

            const product = PRODUCT_DATA.find(p => p.id === productId);
            if (!product) {
                showToast(" Error al encontrar el producto.");
                return;
            }

            const quantity = 1; 
            const priceToUse = product.basePrice; 

            const existingItemIndex = cart.findIndex(item => item.id === product.id);

            if (existingItemIndex > -1) {
                cart[existingItemIndex].quantity += quantity;
                cart[existingItemIndex].price = priceToUse;
            } else {
                cart.push({
                    id: product.id,
                    title: product.title,
                    price: priceToUse,
                    image: product.images[0],
                    quantity: quantity
                });
            }

            saveCart();
            updateCartBadge();
            showToast(` 隆${quantity} unidad(es) de ${product.title.substring(0, 20)}... agregado(s)!`);
        }

        // --- LGICA DE GUARDADOS ---
        window.toggleSavedStatus = function(productId = currentProduct.id) {
            const index = savedProducts.indexOf(productId);
            const button = document.getElementById('save-product-btn');
            
            if (index > -1) {
                // Remove
                savedProducts.splice(index, 1);
                showToast(` Producto eliminado de guardados.`);
                if (button) {
                    button.style.color = 'var(--color-gris-medio)';
                }
            } else {
                // Add
                savedProducts.push(productId);
                showToast(`わ Producto guardado en tu lista.`);
                if (button) {
                    button.style.color = 'var(--color-primario)';
                }
            }
            saveSavedProducts();
            if (savedView.style.display === 'block') {
                 renderSavedItems();
            }
        }

        function updateSaveButtonState(productId) {
            const button = document.getElementById('save-product-btn');
            if (!button) return;
            
            if (savedProducts.includes(productId)) {
                button.style.color = 'var(--color-primario)'; 
            } else {
                button.style.color = 'var(--color-gris-medio)'; 
            }
        }

        function showSavedView() {
            hideAllViews();
            savedView.style.display = 'block';
            document.querySelector('.footer-nav .nav-item[data-view="saved"]').classList.add('active');
            renderSavedItems();
        }

        function renderSavedItems() {
            const container = document.getElementById('saved-items-container');
            const emptyMessage = document.getElementById('empty-saved-message');
            container.innerHTML = '';
            
            if (savedProducts.length === 0) {
                emptyMessage.style.display = 'block';
                return;
            }
            
            emptyMessage.style.display = 'none';
            
            const productsToRender = savedProducts
                .map(id => PRODUCT_DATA.find(p => p.id === id))
                .filter(p => p !== undefined);
            
            productsToRender.forEach(product => {
                container.innerHTML += createProductCardHTML(product);
            });
        }
        // --- FIN LGICA DE GUARDADOS ---
        
        // --- 6. LGICA DEL CARRITO (Render/Checkout) ---
        function showCartView() {
            hideAllViews();
            cartView.style.display = 'block';
            renderCartItems();
        }

        function renderCartItems() {
            const container = document.getElementById('cart-items-container');
            const totalElement = document.getElementById('cart-total');
            const emptyMessage = document.getElementById('empty-cart-message');
            container.innerHTML = '';
            let totalPedido = 0;

            if (cart.length === 0) {
                emptyMessage.style.display = 'block';
                totalElement.textContent = formatCurrency(0);
                return;
            }

            emptyMessage.style.display = 'none';

            cart.forEach(item => {
                const subtotal = item.price * item.quantity;
                totalPedido += subtotal;

                const itemHTML = `
                    <div style="display: flex; gap: 10px; border-bottom: 1px solid #eee; padding-bottom: 15px;">
                        <img src="${item.image}" alt="${item.title}" style="width: 70px; height: 70px; object-fit: cover; border-radius: 5px; background-color: #f0f0f0;">
                        <div style="flex-grow: 1;">
                            <p style="font-weight: 500; font-size: 14px; color: var(--color-negro);">${item.title}</p>
                            <p style="font-size: 16px; font-weight: bold; color: var(--color-primario);">${formatCurrency(item.price)} x ${item.quantity}</p>
                            <p style="font-size: 12px; color: var(--color-gris-medio);">Subtotal: ${formatCurrency(subtotal)}</p>
                        </div>
                        <div style="display: flex; flex-direction: column; justify-content: space-between; align-items: flex-end;">
                            <button onclick="removeItemFromCart(${item.id})" style="background: none; border: none; color: var(--color-secundario); font-size: 16px; cursor: pointer;">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                             <div class="quantity-input-group" style="display: flex; align-items: center; gap: 5px;">
                                <button class="quantity-btn" onclick="updateCartItemQuantity(${item.id}, -1)" style="width: 25px; height: 25px; border-radius: 5px; background-color: #ccc; color: var(--color-negro); border: none; font-weight: bold;">-</button>
                                <span style="font-weight: bold;">${item.quantity}</span>
                                <button class="quantity-btn" onclick="updateCartItemQuantity(${item.id}, 1)" style="width: 25px; height: 25px; border-radius: 5px; background-color: #ccc; color: var(--color-negro); border: none; font-weight: bold;">+</button>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += itemHTML;
            });

            totalElement.textContent = formatCurrency(totalPedido);
        }

        window.removeItemFromCart = function(productId) {
            const initialLength = cart.length;
            cart = cart.filter(item => item.id !== productId);
            if (cart.length < initialLength) {
                saveCart();
                updateCartBadge();
                renderCartItems();
                showToast("锔 Producto eliminado del carrito.");
            }
        }
        
        window.updateCartItemQuantity = function(productId, delta) {
            const itemIndex = cart.findIndex(item => item.id === productId);

            if (itemIndex > -1) {
                const newQuantity = cart[itemIndex].quantity + delta;
                if (newQuantity < 1) {
                    removeItemFromCart(productId);
                } else if (newQuantity <= 10) {
                    cart[itemIndex].quantity = newQuantity;
                    saveCart();
                    updateCartBadge();
                    renderCartItems(); 
                }
            }
        }


        window.checkout = function() {
            if (cart.length === 0) {
                showToast("锔 Su carrito est谩 vac铆o. A帽ada productos primero.");
                return;
            }

            const userDataString = localStorage.getItem('userProfileData');
            const userData = userDataString ? JSON.parse(userDataString) : null;

            if (!userData) {
                showToast("锔 Debe registrar su perfil y direcci贸n para finalizar la compra.");
                handleNavClick('profile'); 
                return;
            }

            let messageBody = "隆Hola! Quisiera realizar el siguiente pedido de la tienda en l铆nea:\n\n";
            let totalPedido = 0;

            cart.forEach((item, index) => {
                const subtotal = item.price * item.quantity;
                totalPedido += subtotal;
                messageBody += `${index + 1}. ${item.title} (x${item.quantity}) - ${formatCurrency(subtotal)}\n`;
            });

            messageBody += "\n----------------------------------\n";
            messageBody += `TOTAL DEL PEDIDO: ${formatCurrency(totalPedido)}\n`;

            messageBody += "\nDATOS DE ENTREGA REGISTRADOS:\n";
            messageBody += `* Nombre Completo: ${userData.name || 'N/A'}\n`;
            messageBody += `* Tel茅fono: ${userData.phone || 'N/A'}\n`;
            messageBody += `* Email: ${userData.email}\n`;
            messageBody += `* Departamento: ${userData.department}\n`;
            messageBody += `* Municipio: ${userData.municipality}\n`;
            messageBody += `* Direcci贸n: C. ${userData.streetNumber || 'N/A'}, Col. ${userData.colonyName || 'N/A'}, Casa ${userData.houseColor || 'N/A'}\n`;
            messageBody += `* Referencia: ${userData.detailedDescription || 'N/A'}\n`;
            messageBody += "\nEspero confirmaci贸n, 隆gracias!";

            const encodedMessage = encodeURIComponent(messageBody);
            const whatsappUrl = `https://wa.me/50375573427?text=${encodedMessage}`;

            window.open(whatsappUrl, '_blank');
            showToast(" Redirigiendo a WhatsApp para finalizar su compra...");
        }

        // --- 7. LGICA DE PERFIL Y REGISTRO ---
        const registrationForm = document.getElementById('registration-form');
        
        function saveUserData(event) {
            event.preventDefault(); 
            
            const userData = {
                name: document.getElementById('reg-name').value,
                phone: document.getElementById('reg-phone').value,
                email: document.getElementById('reg-email').value,
                password: document.getElementById('reg-password').value,
                department: document.getElementById('reg-department').value,
                municipality: document.getElementById('reg-municipality').value,
                colonyName: document.getElementById('reg-colony').value,
                streetNumber: document.getElementById('reg-street').value,
                houseColor: document.getElementById('reg-color').value,
                detailedDescription: document.getElementById('reg-description').value,
            };

            localStorage.setItem('userProfileData', JSON.stringify(userData));
            showToast(" Datos de perfil y direcci贸n guardados correctamente.");
            showProfileView();
        }
        
        function showProfileView() {
            hideAllViews();
            profileView.style.display = 'block';
            document.querySelector('.footer-nav .nav-item[data-view="profile"]').classList.add('active');
            
            const detailsContainer = document.getElementById('profile-details');
            const userDataString = localStorage.getItem('userProfileData');
            
            if (userDataString) {
                const data = JSON.parse(userDataString);
                detailsContainer.innerHTML = `
                    <h3 style="margin-bottom: 5px; color: var(--color-primario);">Datos de Contacto</h3>
                    <p><strong>Nombre:</strong> ${data.name || 'N/A'}</p>
                    <p><strong>Tel茅fono:</strong> ${data.phone || 'N/A'}</p>
                    <p><strong>Correo:</strong> ${data.email}</p>
                    <h3 style="margin-top: 20px; margin-bottom: 5px; color: var(--color-primario);">Direcci贸n de Env铆o</h3>
                    <p><strong>Departamento:</strong> ${data.department}</p>
                    <p><strong>Municipio:</strong> ${data.municipality}</p>
                    <p><strong>Colonia/Barrio:</strong> ${data.colonyName || 'N/A'}</p>
                    <p><strong>Calle/Pasaje:</strong> ${data.streetNumber || 'N/A'}</p>
                    <p><strong>Color de Casa:</strong> ${data.houseColor || 'N/A'}</p>
                    <p><strong>Referencia:</strong> ${data.detailedDescription || 'N/A'}</p>
                `;
            } else {
                detailsContainer.innerHTML = `
                    <p style="text-align: center; color: var(--color-gris-medio);">A煤n no ha registrado sus datos. Por favor, complete el formulario.</p>
                `;
            }
        }
        
        window.showRegistrationForm = function() {
             hideAllViews();
             registrationView.style.display = 'block';
             
             const userDataString = localStorage.getItem('userProfileData');
             if (userDataString) {
                 const data = JSON.parse(userDataString);
                 document.getElementById('reg-name').value = data.name || '';
                 document.getElementById('reg-phone').value = data.phone || '';
                 document.getElementById('reg-email').value = data.email || '';
                 document.getElementById('reg-department').value = data.department || '';
                 document.getElementById('reg-municipality').value = data.municipality || '';
                 document.getElementById('reg-colony').value = data.colonyName || '';
                 document.getElementById('reg-street').value = data.streetNumber || '';
                 document.getElementById('reg-color').value = data.houseColor || '';
                 document.getElementById('reg-description').value = data.detailedDescription || '';
             }
        }
        
        function logout() {
            showToast(" 隆Sesi贸n Cerrada! Vuelva pronto.");
            handleNavClick('main'); 
        }

        // --- INICIALIZACIN ---
        document.addEventListener('DOMContentLoaded', () => {
             PRODUCT_DATA.forEach(p => {
                 if (typeof p.basePrice === 'undefined') {
                     p.basePrice = p.price; 
                     p.discount = calculateDiscount(p.price, p.oldPrice);
                 }
             });
             
            loadCart(); 
            loadRecentProducts(); 
            loadSavedProducts(); 
            
            handleNavClick('main'); 
            
            if (registrationForm) {
                 registrationForm.addEventListener('submit', saveUserData);
            }
            
            // LISTENERS DEL SLIDER (Controlan la navegaci贸n con flechas)
            if (sliderPrevBtn && sliderNextBtn) {
                 sliderPrevBtn.addEventListener('click', (e) => {
                     e.stopPropagation();
                     if (currentProduct && currentProduct.images) {
                         showSliderImage(currentImageIndex - 1);
                     }
                 });

                 sliderNextBtn.addEventListener('click', (e) => {
                     e.stopPropagation();
                     if (currentProduct && currentProduct.images) {
                         showSliderImage(currentImageIndex + 1);
                     }
                 });
             }
            
            // Listener para el bot贸n de retroceso de detalle
            document.getElementById('back-to-main').addEventListener('click', () => {
                handleNavClick('main');
            });
        });
    </script>
</body>
</html>
